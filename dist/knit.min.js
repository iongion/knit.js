/*! knit 17-09-2013 */
var Knit=function(){"use strict";var a=a||{};return a.Vec2=function(a,b){this.x=a||0,this.y=b||0},a.Vec2.prototype={constructor:a.Vec2,distanceSq:function(a){var b=a.x-this.x,c=a.y-this.y;return b*b+c*c},distance:function(a){return Math.sqrt(this.distanceSq(a))}},a.Rect=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},a.Rect.prototype.constructor=a.Rect,a.Constraint=function(a,b,c,d,e){this.p1=a,this.p2=b,this.stiffness=d||1,this.tearDistance=e,this.restingDistance="undefined"==typeof c||0!==c&&!c?this.p1.position.distance(this.p2.position):c},a.Constraint.prototype={constructor:a.Constraint,solve:function(){var a=this.p1.position.x-this.p2.position.x,b=this.p1.position.y-this.p2.position.y,c=Math.sqrt(a*a+b*b);this.tearDistance&&c>this.tearDistance&&this.p1.removeConstraint(this);var d=0===c?this.restingDistance:(this.restingDistance-c)/c,e=1/this.p1.mass,f=1/this.p2.mass,g=e/(e+f)*this.stiffness,h=this.stiffness-g;this.p1.position.x+=a*g*d,this.p1.position.y+=b*g*d,this.p2.position.x-=a*h*d,this.p2.position.y-=b*h*d}},a.PointMass=function(b,c,d){this.position=new a.Vec2(b,c),this.lastPosition=new a.Vec2(b,c),this.acceleration=new a.Vec2(0,0),this.pinPosition=null,this.pinned=!1,this.isWeakPin=!1,this.mass=d||1,this.constraints=[]},a.PointMass.prototype={constructor:a.PointMass,addForce:function(a){this.acceleration.x+=a.x/this.mass,this.acceleration.y+=a.y/this.mass},attach:function(b,c,d,e){var f=new a.Constraint(this,b,c,d,e);return this.addConstraint(f),f},addConstraint:function(a){this.constraints.push(a)},removeConstraint:function(a){for(var b=this.constraints.length;b--;)this.constraints[b]===a&&this.constraints.splice(b,1)},pin:function(b,c,d){null===this.pinPosition&&(this.pinPosition=new a.Vec2),this.pinPosition.x=b,this.pinPosition.y=c,this.pinned=!0,this.isWeakPin=!!d},unpin:function(){this.pinned=!1,this.isWeakPin=!1},solveConstraints:function(a){for(var b=0;b<this.constraints.length;b++)this.constraints[b].solve();if(null!==a.bounds){var c=a.bounds.x+1,d=a.bounds.y+1,e=a.bounds.width-1,f=a.bounds.height-1;this.position.y<d&&(this.position.y=2*d-this.position.y),this.position.y>f&&(this.position.y=2*f-this.position.y),this.position.x<c&&(this.position.x=2*c-this.position.x),this.position.x>e&&(this.position.x=2*e-this.position.x)}}},a.Influence=function(b,c,d,e,f){this.position=new a.Vec2(b,c),this.lastPosition=new a.Vec2,this.distance=d||0,this.scalar=e||1,this.maxDist=f||0,this.tears=!1,this.moves=!0},a.Influence.prototype=new a.PointMass,a.TearInfluence=function(b,c,d){this.position=new a.Vec2(b,c),this.distance=d,this.tears=!0},a.TearInfluence.prototype=new a.Influence,a.World=function(b){this.gravity=b||new a.Vec2(0,1200),this.friction=.99,this.bounds=null,this.accuracy=2,this.points=[],this.move=new a.PointMass(0,0),this.tear=new a.PointMass(0,0),this.tearInfluenceSq=0,this.moveInfluenceSq=0,this.influences=[],this._pinRemoveInfluenceSq=0,this.moveScalar=1.8,this.maxMoveSq=0,this.obstacles=[],this.groundFriction=1,this.floor=null,this.bounds=null},a.World.prototype={constructor:a.World,setPinRemoveInfluence:function(a){this._pinRemoveInfluenceSq=a*a},addInfluence:function(a){this.influences.push(a)},addPoint:function(a){this.points.push(a)},addPoints:function(a){for(var b=0;b<a.length;b++)this.points.push(a[b])},applyMotion:function(a,b,c,d,e){this.moveInfluenceSq=c*c,this.moveScalar=d||1.8,this.move.position.x=a,this.move.position.y=b,0===e?this.maxMoveSq=0:(e=+(e||100),this.maxMoveSq=e*e)},applyTear:function(a,b,c){this.tearInfluenceSq=c*c,this.tear.position.x=a,this.tear.position.y=b},step:function(a){for(var b,c=this.accuracy;c--;)for(var d=0;d<this.points.length;d++)this.points[d].solveConstraints(world);if(this.influences.splice(0,this.influences.length),0!==this.moveInfluenceSq||0!==this.tearInfluenceSq)for(var c=0;c<this.points.length;c++){b=this.points[c];var e=this.move.position.distanceSq(b.position),f=this.tear.position.distanceSq(b.position);if(0!==this.moveInfluenceSq&&e<this.moveInfluenceSq){var g=this.move.position,h=this.move.lastPosition,i=g.x-h.x,j=g.y-h.y,k=i*i+j*j;(0===this.maxMoveSq||k<this.maxMoveSq)&&(i*=this.moveScalar,j*=this.moveScalar,b.lastPosition.x=b.position.x-i,b.lastPosition.y=b.position.y-j,b.isWeakPin&&b.unpin())}else 0!==this._pinRemoveInfluenceSq&&e<this._pinRemoveInfluenceSq&&b.isWeakPin&&b.unpin();0!==this.tearInfluenceSq&&f<this.tearInfluenceSq&&(b.constraints=[])}for(var c=0;c<this.points.length;c++){b=this.points[c],b.addForce(world.gravity);var l=b.position.x-b.lastPosition.x,m=b.position.y-b.lastPosition.y;l*=this.friction,m*=this.friction;var n=l*l+m*m;if(null!==this.floor&&b.position.y>=this.floor&&n>1e-6){var o=Math.sqrt(n);0!=o&&(l/=o,m/=o),l*=o*this.groundFriction,m*=o*this.groundFriction}var p=a*a,q=b.position.x+l+.5*b.acceleration.x*p,r=b.position.y+m+.5*b.acceleration.y*p;b.lastPosition.x=b.position.x,b.lastPosition.y=b.position.y,b.position.x=q,b.position.y=r,b.acceleration.x=0,b.acceleration.y=0}for(var c=0;c<this.points.length;c++){var b=this.points[c];b.pinned&&null!==b.pinPosition&&(b.position.x=b.pinPosition.x,b.position.y=b.pinPosition.y)}this.move.lastPosition.x=this.move.position.x,this.move.lastPosition.y=this.move.position.y,this.tear.lastPosition.x=this.tear.position.x,this.tear.lastPosition.y=this.tear.position.y,this.moveInfluenceSq=this.tearInfluenceSq=0}},a.rnd=function(a,b){return a+Math.random()*(b-a)},a.lerp=function(a,b,c){return a*(1-c)+b*c},a.smoothstep=function(a,b,c){return c=Math.max(0,Math.min(1,(c-a)/(b-a))),c*c*(3-2*c)},a.shuffle=function(a){for(var b,c,d=a.length;d--;)c=0|Math.random()*d,b=a[d],a[d]=a[c],a[c]=b;return a},a.distanceTo=function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},a}();!function(){"use strict";Knit.Path=function(a){if(this.mass=0,this.stiffness=1,this.points=[],this.tearDistance=0,this.steps=1,this.approximateCurves=!0,this.approximationFactor=.05,this._move=new Knit.Vec2,this._start=new Knit.Vec2,this._newPath=!0,this._toPin=!1,this._toPinWeak=!1,this._hasMoved=!1,a&&"object"==typeof a)for(var b in a)b in this&&(this[b]=a[b])},Knit.Path.prototype={constructor:Knit.Path,reset:function(){this.points=[],this._newPath=!0,this._hasMoved=!1,this._move.x=this._move.y=0,this._start.x=this._start.y=0,this._toPin=!1,this._toPinWeak=!1},pinNext:function(a){this._toPin=!0,this._toPinWeak=a},pinLast:function(a){if(0!=this.points.length){var b=this.points[this.points.length-1];b.pin(b.position.x,b.position.y,a)}},moveTo:function(a,b){this._newPath=!0,this._move.x=a,this._move.y=b,this._start.x=a,this._start.y=b,this._hasMoved=!0},lastPoint:function(){return 0!==this.points.length?this.points[this.points.length-1]:null},firstPoint:function(){return 0!==this.points.length?this.points[0]:null},close:function(a){0!==this.points.length&&this.lineTo(this._start.x,this._start.y,a)},__newPoint:function(a,b){var c=new Knit.PointMass(a,b,this.mass);!this._newPath&&this.points.length>0&&c.attach(this.points[this.points.length-1],null,this.stiffness,this.tearDistance),this._toPin&&(c.pin(a,b,this._toPinWeak),this._toPin=!1,this._toPinWeak=!1),this.points.push(c),this._newPath=!1},lineTo:function(a,b,c){if(!this._hasMoved)return this.moveTo(a,b),void 0;c=Math.max(1,c||this.steps);for(var d=0;c>=d;d++)if(this._newPath||0!=d){var e=d/c,f=Knit.lerp(this._move.x,a,e),g=Knit.lerp(this._move.y,b,e);this.__newPoint(f,g)}this._move.x=a,this._move.y=b},bezierCurveTo:function(a,b,c,d,e,f,g){if(!this._hasMoved)return this.moveTo(t,u),void 0;var h=this._move.x,i=this._move.y;if(!g)if(this.approximateCurves){var j=Knit.distanceTo(h,i,a,b),k=Knit.distanceTo(a,b,c,d),l=Knit.distanceTo(c,d,e,f);g=~~((j+k+l)*this.approximationFactor)}else g=Math.max(1,this.steps);for(var m=0;g>m;m++){var n=m/(g-1),o=1-n,p=o*o,q=p*o,r=n*n,s=r*n,t=q*h+3*p*n*a+3*o*r*c+s*e,u=q*i+3*p*n*b+3*o*r*d+s*f;this.__newPoint(t,u)}this._move.x=c,this._move.y=d},quadraticCurveTo:function(a,b,c,d,e){if(!this._hasMoved)return this.moveTo(o,p),void 0;var f=this._move.x,g=this._move.y;if(!e)if(this.approximateCurves){var h=Knit.distanceTo(f,g,a,b),i=Knit.distanceTo(a,b,c,d);e=~~((h+i)*this.approximationFactor)}else e=Math.max(1,this.steps);for(var j=0;e>j;j++){var k=j/(e-1),l=1-k,m=l*l,n=k*k,o=m*f+2*l*k*a+n*c,p=m*g+2*l*k*b+n*d;this.__newPoint(o,p)}this._move.x=c,this._move.y=d}},Knit.Twine=function(a){if(this.start=new Knit.Vec2,this.end=new Knit.Vec2,this.steps=5,this.mass=0,this.stiffness=1,this.points=[],this.pinStart=!0,this.pinEnd=!1,this.weakPins=!1,this.tearDistance=0,a&&"object"==typeof a)for(var b in a)b in this&&(this[b]=a[b]);this.create()},Knit.Twine.prototype={constructor:Knit.Twine,create:function(){this.points=[];var a=0;for(a=0;a<this.steps;a++){var b=a/this.steps,c=Knit.lerp(this.start.x,this.end.x,b),d=Knit.lerp(this.start.y,this.end.y,b),e=new Knit.PointMass(c,d,this.mass);(0===a&&this.pinStart||a===this.steps-1&&this.pinEnd)&&e.pin(c,d,this.weakPins),0!==a&&e.attach(this.points[a-1],null,this.stiffness,this.tearDistance),this.points.push(e)}}}}();var TypeUtil=function(){function a(a,b,c,d,e){f=a,g=b,c&&c.push(new Knit.Vec2(a*d.x+e.x,b*d.y+e.y))}function b(a,b,c,d,e,h){for(var i=f,j=g,k=0;c>k;k++){var l=k/(c-1),m=Knit.lerp(i,a,l),n=Knit.lerp(j,b,l);d.push(new Knit.Vec2(m*e.x+h.x,n*e.y+h.y))}f=a,g=b}function c(a,b,c,d,e,h,i,j,k,l){for(var m=f,n=g,o=0;i>o;o++){var p=o/(i-1),q=1-p,r=q*q,s=r*q,t=p*p,u=t*p,v=s*m+3*r*p*a+3*q*t*c+u*e,w=s*n+3*r*p*b+3*q*t*d+u*h;j.push(new Knit.Vec2(v*k.x+l.x,w*k.y+l.y))}f=c,g=d}function d(a,b,c,d,e,h,i,j){for(var k=f,l=g,m=0;e>m;m++){var n=m/(e-1),o=1-n,p=o*o,q=n*n,r=p*k+2*o*n*a+q*c,s=p*l+2*o*n*b+q*d;h.push(new Knit.Vec2(r*i.x+j.x,s*i.y+j.y))}f=c,g=d}var e=e||{},f=0,g=0,h={fontSize:12,fontStretchPercent:1,letterSpacing:0};return e.getFaces=function(){return _typeface_js.faces},e.getFace=function(a,b,c){b=b||"normal",c=c||"normal",a=a.toLowerCase();var d=null;if(_typeface_js&&_typeface_js.faces){if(!(a in _typeface_js.faces))return console.log("No font with the name "+a),void 0;var e=_typeface_js.faces[a];if(!(b in e))return console.log("No weight with the value "+b),void 0;var f=e[b];if(!(c in f))return console.log("No style with the type "+c),void 0;d=f[c]}return d},e.getFaceHeight=function(a,b){return h.fontSize=b,Math.round(_typeface_js.pixelsFromPoints(a,h,a.lineHeight))},e.getPointScale=function(a,b){return h.fontSize=b,_typeface_js.pixelsFromPoints(a,h,1)},e.getPointLists=function(e,f,g,i){i=i||10,h.fontSize=f;var j=e.glyphs[g];if(!j||!j.o)return null;a(0,0);for(var k=[],l=[],m=_typeface_js.pixelsFromPoints(e,h,1),n=new Knit.Vec2(m*h.fontStretchPercent,-m),o=new Knit.Vec2(0,e.ascender*m),p=j.o.split(" "),q=p.length,r=0;q>r;){var s=p[r++];switch(s){case"m":1!==r&&(k.push(l),l=[]),a(p[r++],p[r++],l,n,o);break;case"l":b(p[r++],p[r++],i,l,n,o);break;case"q":var t=p[r++],u=p[r++];d(p[r++],p[r++],t,u,i,l,n,o);break;case"b":var v=p[r++],w=p[r++];c(p[r++],p[r++],p[r++],p[r++],v,w,i,l,n,o)}}return k.push(l),k},e}(),CanvasUtil=function(a){var b=b||{},c=null,d=!1;b.pinDragEnabled=!0,b.pinRadius=10;var e=function(a,b,c,d){a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!1),a.stroke()};return b.nearestPin=function(a,c,d){for(var e=b.pinRadius,f=e*e,g=a.points,h=g.length,i=Number.MAX_VALUE,j=null;h--;)if(g[h].pinned&&g[h].pinPosition){var k=c-g[h].pinPosition.x,l=d-g[h].pinPosition.y,m=k*k+l*l;f>m&&i>m&&(j=g[h],i=m)}return j},b.isMouseOverPin=function(){return null!==c},b.addPinInteraction=function(a,e){var f=b.pinRadius;a.mousemove(function(a){var g=a.pageX,h=a.pageY;!c&&d&&(d=!1),c&&d&&b.pinDragEnabled?(c.pinPosition.x=g,c.pinPosition.y=h):c=b.nearestPin(e,g,h,f)}),a.mousedown(function(){d=!0}),a.mouseup(function(){d=!1})},b.drawPins=function(a,d,f,g,h){var i=a.points,j=i.length;if(0!=j){var f=b.pinRadius;for(g||(g=d.strokeStyle,h="green");j-->0;){var k=i[j];if(k.pinned&&k.pinPosition){var l=k.pinPosition.x,m=k.pinPosition.y;d.strokeStyle=k===c?h:g,e(d,l,m,f)}}}},b.drawPoints=function(a,b){var c=a.points,d=c.length;if(0!=d){for(b.beginPath();d-->0;)for(var e=c[d],f=0;f<e.constraints.length;f++){var g=e.constraints[f];g.p1&&g.p2&&(b.moveTo(g.p1.position.x,g.p1.position.y),b.lineTo(g.p2.position.x,g.p2.position.y))}b.stroke()}},b.createCanvas=function(b,c,d){d=d||"canvas";var e=a("<canvas/>",{id:d});return e[0].width=b,e[0].height=c,e},b}(jQuery);!function(){"use strict";function a(a,b,c,d){for(var e=~~(a*Knit.rnd(c,d)),f=[],g=b;a>g;g++)f.push(g);return f=Knit.shuffle(f),f.splice(0,e)}Knit.Web=function(a){if(this.spirals=10,this.spokes=10,this.radius=100,this.hubRadius=20,this.cx=0,this.cy=0,this.centerMass=1,this.webMass=10,this.tensor=.5,this.stiffness=.15,this.tearDistance=100,this.missChanceLow=.2,this.missChanceHigh=.25,this.cutChanceLow=.01,this.cutChanceHigh=.2,this.cutTensor=.75,this.points=[],a&&"object"==typeof a)for(var b in a)b in this&&(this[b]=a[b]);this.create()},Knit.Web.prototype={consructor:Knit.Web,create:function(){this.points=[];var b=360/this.spokes,c=[],d=0;for(c.push(new Knit.Vec2(this.cx,this.cy)),d=0;d<360*this.spirals+b;d+=b){var e=0,f=d+e,g=Math.cos(f*(Math.PI/180)),h=Math.sin(f*(Math.PI/180)),i=g*this.hubRadius+this.cx,j=h*this.hubRadius+this.cy;this.radius;var k=d/360*(this.radius-this.hubRadius)/this.spirals;k*=d/(360*this.spirals+b);var l=g*k+i,m=h*k+j;c.push(new Knit.Vec2(l,m))}var n=0,o=c.length,p=null;for(d=0;o>d;d++){n=this.points.length;var q=c[d],r=0==d?this.centerMass:this.webMass;if(p=new Knit.PointMass(q.x,q.y,r),d>1&&d<o-1-this.spokes){var s=this.points[d-1];p.attach(s,null,this.stiffness,this.tearDistance)}d<this.spokes&&d>0&&(0==d%2||Math.random()<.5)&&p.attach(this.points[0],null,this.stiffness,this.tearDistance);var t=n-1-this.spokes+1;if(t>0&&n-1>t){var u=p.attach(this.points[t],null,this.stiffness,this.tearDistance);u.restingDistance*=this.tensor}this.points.push(p)}for(n=this.points.length,d=0;d<this.points.length;d++)p=this.points[d],d>n-1-this.spokes&&p.pin(p.position.x,p.position.y,!1),1==d&&p.attach(this.points[d+this.spokes-1],null,this.stiffness,this.tearDistance);var v,w=a(n-1-this.spokes,this.spokes,this.missChanceLow,this.missChanceHigh);for(d=0;d<w.length;d++)if(v=w[d],0===v%2){var x=Math.random()?-1:1,y=Math.random()>.5?1:-1,z=v+y*this.spokes+x;z>=0&&z<this.points.length-1&&this.points[v].attach(this.points[z],null,this.stiffness,this.tearDistance)}var A=a(n-1-this.spokes,this.spokes,this.cutChanceLow,this.cutChanceHigh);for(d=0;d<A.length;d++){v=A[d],p=this.points[v],p.constraints.splice(0,1);for(var B=0;B<p.constraints.length;B++)p.constraints[B].restingDistance*=this.cutTensor}for(d=this.spokes;d<this.points.length;d++)d==this.points.length-~~(this.spokes/2)||d==this.points.length-1}}}();