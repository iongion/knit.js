
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width">
    <title>Woven Silk</title>
<!--    <link rel="stylesheet" href="/css/normalize.min.css">-->
<!--    <script src="js/vendor/jquery-1.10.1.min.js" type="text/javascript"></script>-->
    <script src="js/vendor/jquery-1.10.1.min.js"></script>
    <script src="js/vendor/poly2tri.js"></script>
    <script src="js/vendor/typeface-0.15.js"></script>
    <script src="js/vendor/helvetiker_regular.typeface.js"></script>
    <script src="js/vendor/helvetiker_bold.typeface.js"></script>
    <script src="js/vendor/helvetiker_bold_italic.typeface.js"></script>
    <script src="js/vendor/montserrat_bold.typeface.js"></script>
    <script src="js/vendor/montserrat_regular.typeface.js"></script>
    <script src="js/vendor/stalemate_regular.typeface.js"></script>
      
    <script src="js/Knit.js"></script>
    <script src="js/TypeUtil.js"></script>
    <script src="js/KnitFabrics.js"></script>
    
    <script src="js/vendor/raf.js"></script>
    <script src="js/CanvasUtil.js"></script>
    
    <style type="text/css">
        * { margin: 0; padding: 0; }
        
        body { background-color: white; }
/*        canvas { background-color: red; }*/
    </style>
  </head>
     
  <body> 
      
      <div id="canvas-container">
      </div>  
<script>
    var width = window.innerWidth, height = window.innerHeight;
    var canvas = CanvasUtil.createCanvas(width, height);
    canvas.appendTo($("#canvas-container"));
    
    var context = canvas[0].getContext("2d");
    
    setInterval(update, 1000/60);
    
    var mouseInfluence = 15;
    var mouseScale = 0.5;
    var mouseMaxDist = 15;
    
    var mouseTearInfluence = 15;
    var gravity = 1200;
    var useFloor = false;
    
    var enableWind = false;
    
    var world = new Knit.World(new Knit.Vec2(0, gravity));
    world.setPinRemoveInfluence(50);
    var endPoint = null;
    
    CanvasUtil.addPinInteraction(canvas, world);
    
    var mouseX=0, mouseY=0;
    var web = null;
    
    if (useFloor) {
        world.bounds = new Knit.Rect(0, 0, width, height);
        world.floor = height-5;
    }
    
    $(document).keypress(function(e) {
        world.points = [];
        createFabrics(); 
    }); 
    $(function() {
        createFabrics();
        
        
    });  
    
    var mouseDown = false;
    canvas.mousedown(function(ev) {
        if (ev.which == 1)
            mouseDown = true;
    });
    canvas.mouseup(function(ev) {
        if (ev.which == 1)
            mouseDown = false;
    });
     
    canvas.mousemove(function(ev) {
        if (mouseDown) {
            if (!CanvasUtil.isMouseOverPin())
                world.applyTear(ev.clientX, ev.clientY, mouseTearInfluence);
            world.applyMotion(ev.clientX, ev.clientY, mouseInfluence, mouseScale, mouseMaxDist);
        } else
            world.applyMotion(ev.clientX, ev.clientY, mouseInfluence, mouseScale, mouseMaxDist);
        mouseX = ev.clientX;
        mouseY = ev.clientY;
    });
    
    function createFabrics() {
//        var str = new Knit.Twine({ start:new Knit.Vec2(100, 100), end:new Knit.Vec2(110, 150), steps: 50 });
//        endPoint = str.points[str.points.length-1];    
//        world.addPoints(str.points);
        
        var path = new Knit.Path();
//        path.tearDistance = 50;
        path.stiffness = 0.99;
        path.steps = 1;
        
//        path.pinNext(); 
//        path.moveTo(300, 50);
//        path.lineTo(310, 100);
//        
//        path.moveTo(500, 40);
//        path.pinNext();
//        path.lineTo(550, 100);
//        path.pinLast();
//        path.lineTo(600, 70); 
//        path.pinLast();
//        path.close();
//        path.pinLast();
        
        path.pinNext();
        path.moveTo(100,60);
        path.quadraticCurveTo(20,100,200,20);
        path.pinLast();
        
        console.log(path.points.length);
        
        world.addPoints(path.points);
    }
     
    function update() { 
        context.clearRect(0, 0, width, height);
        
        world.step(0.016);
        
        context.fillStyle = "black";
        context.strokeStyle = "black";
        context.lineWidth = 0.5;
        
        CanvasUtil.drawPoints(world, context);
        CanvasUtil.drawPins(world, context);
        
        if (endPoint) {
            context.fillStyle = "red";
            var sz = 10;
            context.fillRect(endPoint.position.x-sz/2, endPoint.position.y-sz/2, sz, sz);
        }
        
        context.beginPath(); 
//        context.moveTo(300, 250);
//        context.lineTo(310, 200);
//        context.lineTo(500, 500);
//        
//        context.moveTo(400, 250);
//        context.lineTo(450, 300);
//        context.lineTo(500, 200);
//        context.moveTo(500, 500);
        
        
        context.moveTo(20,20);
//        context.bezierCurveTo(20,100,200,100,200,20);
        
//        context.closePath();
        context.stroke();
    }
</script>
       
<!--      <div>Hi thasere</div>-->
  </body>
</html>